i <- c(cl, bio)
id <- patient_hpo_bio_mat[row.names(patient_hpo_bio_mat) %in% i, ]
# count the number of patients
s <- sum(colSums(id) == 3)
mat_long <- rbind(mat_long, c("smb_normal & tr_high", cl,s))
}
cluster_demographics <- as.data.frame(mat_long)
# The y axis is a "proportion of patients within the cluster"
cluster_demographics$cluster_proportion[cluster_demographics$cluster ==
"infection_cluster"] <-
cluster_demographics$patient_number[
cluster_demographics$cluster == "infection_cluster"]/nrow(infection_cluster)
cluster_demographics$patient_number
infection_cluster
nrow(infection_cluster)
cluster_demographics$patient_number[
cluster_demographics$cluster == "infection_cluster"]/nrow(infection_cluster)
class(cluster_demographics)
str(cluster_demographics)
cluster_demographics$patient_number <- as.numeric(cluster_demographics$patient_number)
# The y axis is a "proportion of patients within the cluster"
cluster_demographics$cluster_proportion[cluster_demographics$cluster ==
"infection_cluster"] <-
cluster_demographics$patient_number[
cluster_demographics$cluster == "infection_cluster"]/nrow(infection_cluster)
cluster_demographics$cluster_proportion[cluster_demographics$cluster ==
"complex_cluster"] <-
cluster_demographics$patient_number[
cluster_demographics$cluster == "complex_cluster"]/nrow(complex_cluster)
cluster_demographics$cluster_proportion <- unlist(cluster_demographics$cluster_proportion)*100
cluster_demographics$cluster_proportion
cluster_demographics$long_name[cluster_demographics$name == "smb_normal"] <- "SmB+"
cluster_demographics$long_name[cluster_demographics$name == "smb_minus"] <- "SmB-"
cluster_demographics$long_name[cluster_demographics$name == "cd21_low"] <- "CD21low high" # cd21_low >= 10
cluster_demographics$long_name[cluster_demographics$name == "cd21_plus"] <- "CD21low normal" # cd21_plus < 10
cluster_demographics$long_name[cluster_demographics$name == "tr_norm"] <- "Transitional B normal"
cluster_demographics$long_name[cluster_demographics$name == "tr_high"] <- "Transitional B high"
cluster_demographics$long_name[cluster_demographics$name == "llh"] <- "lowIgG-lowIgA-highIgM"
cluster_demographics$long_name[cluster_demographics$name == "lln"] <- "lowIgG-lowIgA-normalIgM"
cluster_demographics$long_name[cluster_demographics$name == "lll"] <- "lowIgG-lowIgA-lowIgM"
cluster_demographics$long_name[cluster_demographics$name == "lnl"] <- "lowIgG-normalIgA-lowIgM"
cluster_demographics$long_name[cluster_demographics$name == "canonicalTNFRSF13B"] <- "canonical TNFRSF13B"
cluster_demographics$long_name[cluster_demographics$name == "rareTNFRSF13B"] <- "rare TNFRSF13B"
cluster_demographics$long_name[cluster_demographics$name == "NFKB1"] <- "NFKB1"
cluster_demographics$long_name[cluster_demographics$name == "anyPathogenic"] <- "any Pathogenic variant"
cluster_demographics$long_name[cluster_demographics$name == "smb_normal & tr_high"] <- "SmB+ & Transitional B high"
cluster_demographics$long_name[cluster_demographics$name == "smb_normal & tr_norm"] <- "SmB+ & Transitional B normal"
cluster_demographics$cluster <- gsub(pattern = "_cluster",
x = cluster_demographics$cluster,
replacement ="")
# split between bio and gene
cluster_demographics$category <- "phenotype"
i <- c("anyPathogenic","NFKB1","rareTNFRSF13B","canonicalTNFRSF13B" )
cluster_demographics
fwrite(cluster_demographics, "../result/cluster_demographics.csv")
######################## source common libraries ###############################
source("common.R")
cluster_demographics <- fread("../result/cluster_demographics.csv")
cr <- fread( "../result/bio_cluster_tests.csv") # cluster
cr <- cr %>% dplyr::filter(biological_measure %in% c("smb",
"cd21",
"NFKB1",
"anyPathogenic"))
# filter for the significant associations only
# smb, cd21, NFKB1, anyPathogenic
Fig5data <- cluster_demographics %>%
dplyr::filter(name %in% c("smb_normal",
"smb_minus",
"cd21_low",
"cd21_plus" ,
"NFKB1",
"anyPathogenic"))
# add a column matching the p value table
Fig5data$biological_measure <- gsub("_.*$",
Fig5data$name,
replacement = "")
p_value_data <- Fig5data %>%
dplyr::filter(name %in% c(
"NFKB1",
"anyPathogenic")) %>%
# Group by the x-axis variable and the joining key
group_by(long_name, biological_measure) %>%
# Find the position of the end of the *longest* bar in the group
summarize(y_pos = max(cluster_proportion), .groups = 'drop') %>%
# Join the p-value data from 'cr'
left_join(cr, by = "biological_measure") %>%
# Format the p-value label for plotting
# "%.2g" is good for scientific notation.
mutate(p_label = sprintf("p = %.2g", BH_adjust_pvalue))
# Create a data frame for the bracket(s)
bracket_data <- data.frame(
# 1. Specify the facet:
# match 'Fig5data$category'
category = c("phenotype","phenotype"),
# 2. Specify the start and end points (the 'long_name' values):
xmin = c("SmB+", "CD21low normal"),
xmax = c("SmB-", "CD21low high"),
# 3. Specify the y-position (on the proportion axis):
y.position = c(45, 40),
# 4. Specify the label for the bracket:
label = c("p = 0.00017" , "p = 0.00002")
)
ggplot(Fig5data,
aes(fill = cluster,
y = cluster_proportion,
x = long_name)) +
geom_bar(position = "dodge",
stat = "identity") +
geom_text(data = p_value_data,
aes(x = long_name,
y = y_pos + 0.02,
label = p_label),
inherit.aes = FALSE,
vjust = 0,
hjust = -0.5) +
geom_bracket(
data = bracket_data,
aes(xmin = xmin,
xmax = xmax,
y.position = y.position,
label = label),
inherit.aes = FALSE,
tip.length = 0.015,
vjust = 3,
hjust = 1) +
scale_fill_manual(values = infComp) +
scale_x_discrete(labels = c("SmB+" = "smB+" ,
"SmB-" = "smB-",
"CD21low high" = expression("CD21"^lo),
"CD21low normal" = expression("CD211"^norm),
"NFKB1" = "NFKB1",
"any Pathogenic variant" = "Any Pathogenic Variant",
"SmB+" = "smB+",
"SmB-"  = "smB-" ,
"CD21low high" = expression("CD21"^lo),
"CD21low normal" = expression("CD211"^norm),
"NFKB1" = "NFKB1",
"any Pathogenic variant" = "Any Pathogenic Variant")) +
ylab("Proportion of patients within the cluster") +
xlab("") +
coord_flip() +
theme_bw() +
ylim(c(0, 45))
ggsave("../result/Fig5/Fig5.jpeg",
width = 15,
height = 10,
units = "cm")
######################## source common libraries ###############################
source("common.R")
# load presence/absence matrix
patient_hpo_bio_mat <- readRDS("patient_hpo_bio_mat.RDS")
# load presence/absence matrix
patient_hpo_bio_mat <- readRDS("../result/patient_hpo_bio_mat.RDS")
# subset to just the HPO terms and the patients with complete B cell
patient_hpo_mat <- patient_hpo_bio_mat[grep("^HP",
rownames(patient_hpo_bio_mat)), ]
# keep HPO terms that are present at least once
patient_hpo_mat <- patient_hpo_mat[rowSums(patient_hpo_mat) != 0, ]
# two colums: each row represents an edge
result <- do.call(rbind, lapply(row.names(patient_hpo_mat), function(term) {
connectors <- c(hpo$ancestors[[term]], hpo$children[[term]])
connectors <- unique(na.omit(connectors))  # remove duplicates + NAs
connectors <- connectors[connectors != term]  # remove self-links
if (length(connectors) > 0) {
data.frame(term = term,
connector = connectors,
stringsAsFactors = FALSE)
}
}))
# Get all unique HPO codes
all_hpos <- unique(c(result$term, result$connector))
# obsolete terms:
obsolete_terms <- row.names(patient_hpo_mat)[!row.names(patient_hpo_mat) %in%
all_hpos]
# Create a lookup table mapping HPO -> integer ID
hpo_id <- setNames(seq_along(all_hpos), all_hpos)
# Make a copy of result and add numeric IDs
result_with_id <- result
result_with_id$term_id <- hpo_id[result$term]
result_with_id$connector_id <- hpo_id[result$connector]
fwrite(result_with_id,
paste("../result/reduc_dim_input_with_id_", thisfocus, ".csv", sep = ""))
fwrite(result_with_id[,3:4],
paste("../result/HPO_id_", thisfocus, ".tsv", sep = ""),
col.names = F, sep = "\t")
thisfocus <- "no_Bcell_filtering"
fwrite(result_with_id,
paste("../result/reduc_dim_input_with_id_", thisfocus, ".csv", sep = ""))
fwrite(result_with_id[,3:4],
paste("../result/HPO_id_", thisfocus, ".tsv", sep = ""),
col.names = F, sep = "\t")
patient_hpo_mat <- patient_hpo_mat[!rownames(patient_hpo_mat) %in% obsolete_terms,]
saveRDS(patient_hpo_mat,
paste("../result/patient_hpo_bio_mat_for_reduc_dim_", thisfocus,".rds", sep = ""))
######################## source common libraries ###############################
source("common.R")
# load nbr
nbr <- readRDS("../result/tidy_data")
############# Part B ###########################################################
thisfocus <- "no_Bcell_filtering" # the data includes incomplete data
# each row describes the relationship between two HPO terms
# e.g. 1st row: relationship between term 1 (HP:0004315) and term 885 (HP:0000001)
result_with_id <- fread(paste("../result/reduc_dim_input_with_id_",
thisfocus, ".csv", sep = ""))
# import the embeddings (capturing the context of the HPO,
# how often it is associated with other HPOs in the onthology pathway)
HPO_id_embeddings <-
fread(paste("../result/HPO_id_", thisfocus,"_embeddings.emb", sep =""), skip = 1)
############# Part B ###########################################################
thisfocus <- "no_Bcell_filtering" # the data includes incomplete data
# each row describes the relationship between two HPO terms
# e.g. 1st row: relationship between term 1 (HP:0004315) and term 885 (HP:0000001)
result_with_id <- fread(paste("../result/reduc_dim_input_with_id_",
thisfocus, ".csv", sep = ""))
# import the embeddings (capturing the context of the HPO,
# how often it is associated with other HPOs in the onthology pathway)
HPO_id_embeddings <-
fread(paste("../result/HPO_id_", thisfocus,"_embeddings.emb", sep =""), skip = 1)
# import the embeddings (capturing the context of the HPO,
# how often it is associated with other HPOs in the onthology pathway)
HPO_id_embeddings <-
fread(paste("../result/HPO_id_", thisfocus,"_embeddings.emb", sep =""), skip = 1)
# import presence absence of HPO
# no obsolete terms (aka terms with no edge)
# HPO terms that are present at least once
# all patients
phmnoNA <-
readRDS(paste("../result/patient_hpo_bio_mat_for_reduc_dim_", thisfocus,".rds", sep = ""))
######################## source common libraries ###############################
source("common.R")
# load nbr
nbr <- readRDS("../result/tidy_data")
thisfocus <- "no_Bcell_filtering" # the data includes incomplete data
# each row describes the relationship between two HPO terms
# e.g. 1st row: relationship between term 1 (HP:0004315) and term 885 (HP:0000001)
result_with_id <- fread(paste("../result/reduc_dim_input_with_id_",
thisfocus, ".csv", sep = ""))
# import the embeddings (capturing the context of the HPO,
# how often it is associated with other HPOs in the onthology pathway)
HPO_id_embeddings <-
fread(paste("../result/HPO_id_", thisfocus,"_embeddings.emb", sep =""), skip = 1)
# import presence absence of HPO
# no obsolete terms (aka terms with no edge)
# HPO terms that are present at least once
# all patients
phmnoNA <-
readRDS(paste("../result/patient_hpo_bio_mat_for_reduc_dim_", thisfocus,".rds", sep = ""))
# load patient clusters
infection_cluster <- fread("../result/InfectionBronchiectasisPatients.csv")
complex_cluster <- fread("../result/complexPatients.csv")
############# analyse ###########################################################
colnames(infection_cluster) <- "STUDY_ID"
colnames(complex_cluster) <- "STUDY_ID"
complex_patients <- complex_cluster$STUDY_ID
infection_patients <- infection_cluster$STUDY_ID
# vector of term ID in the order of the patient hpo matrix
term_order_in_phm <- result_with_id$term_id[match(row.names(phmnoNA),
result_with_id$term)]
# reorder the rows of HPO_id_embeddings using the order of the phm
hieo <- HPO_id_embeddings[match(term_order_in_phm,
HPO_id_embeddings$V1), -c("V1")]
phm <- phmnoNA
# set counts of:
N_HPO_TERMS <- nrow(phm) # 884
D_DIMENSION <- ncol(hieo) # 128
N_PATIENTS <- ncol(phm) # 528
# terms x dimensions
HPO_FEATURES_F <- hieo
denom = matrix(colSums(phm),
nrow = nrow(phm),
ncol = ncol(phm),
byrow = TRUE)
# patients x terms
PATIENT_PHENOTYPE_P <- t(phm/denom)
HPO_FEATURES_F <- as.matrix(HPO_FEATURES_F)
# Patient Embeddings = P %*% F Matrix Multiplication
# The matrix multiplication P (528 x 884) %*% F (800x128) yields P_embeddings (884 x 129).
# This transforms the sparse patient profile into a dense vector reflecting the
# structural similarity encoded by the HPO embeddings.
patient_embeddings_P_embeddings <- PATIENT_PHENOTYPE_P %*% HPO_FEATURES_F
## pca
p=prcomp(patient_embeddings_P_embeddings)$x  %>% as.data.frame()
p$cluster <- ifelse(rownames(p) %in% complex_patients,
"complex",
ifelse(rownames(p) %in% infection_patients,
"infection", NA))
p$CENTRE <- nbr$CENTRE[match(rownames(p), nbr$STUDY_ID)]
left=ggplot(p,
aes(x=PC1, y=PC2, col=cluster)) +
geom_point(size = 0.71) +
scale_colour_manual(values = infComp)
right=ggplot(p, aes(x=PC1, y=PC2, col=CENTRE, shape=CENTRE)) +
geom_point() +
scale_fill_manual(values = centrescol) +
scale_colour_manual(values = centrescol) +
scale_shape_manual(values = c(1:11))
patchwork2 <-  left / right
patchwork2 + plot_annotation(tag_levels = 'a')
ggsave("../result/Fig6/Fig6.jpeg",
width = 18,
height = 18,
units = "cm")
######################## source common libraries ###############################
source("common.R")
######################## import input ##########################################
# load in the test results for B cell, Immuno, genetic, cluster
br <- fread( "../result/B_cell_HPO_tests.csv") # B cell
ir <- fread( "../result/Immuno_HPO_tests1.csv") # immuno
######################## import input ##########################################
# load in the test results for B cell, Immuno, genetic, cluster
br <- fread( "../result/B_cell_HPO_tests.csv") # B cell
ir <- fread( "../result/Immuno_HPO_tests.csv") # immuno
gr <- fread( "../result/genetic_HPO_tests.csv") # genetic
cr <- fread( "../result/bio_cluster_tests.csv") # cluster
# load in the ratio
brr <- fread( "../result/B_cell_HPO_tests_summary_contingency_with_ratio.csv")
irr <- fread( "../result/Immuno_HPO_tests_summary_contingency_with_ratio.csv")
grr <- fread( "../result/genetic_HPO_tests_summary_contingency_with_ratio.csv")
crr <- fread( "../result/cluster_HPO_tests_summary_contingency_with_ratio.csv")
# make one table per test
bat <- brr %>%
mutate(adjP = br$BH_adjust_pvalue[match(brr$HPO_code, br$phenotype_code)],
phenotype_name = br$phenotype_name[match(brr$HPO_code, br$phenotype_code)]) %>%
dplyr::select(-c(patients_with_hpo, total_patients_in_group))
######################## analyse ##########################################
# make one table per test
bat <- brr %>%
mutate(adjP = br$BH_adjust_pvalue[match(brr$HPO_code, br$phenotype_code)],
phenotype_name = br$phenotype_name[match(brr$HPO_code, br$phenotype_code)]) %>%
dplyr::select(-c(patients_with_hpo, total_patients_in_group))
fwrite(bat, "../result/Table3/Table3A.csv")
gat <- grr %>%
mutate(adjP = gr$BH_adjust_pvalue[match(grr$HPO_code, gr$phenotype_code)],
phenotype_name = gr$phenotype_name[match(grr$HPO_code, gr$phenotype_code)]) %>%
dplyr::select(-c(patients_with_hpo, total_patients_in_group))
fwrite(gat, "../result/Table3/Table3B.csv")
# immuno
irr$biological_measure <- ir$biological_measure[match(irr$HPO_code, ir$phenotype_code)]
iat <- irr %>%
mutate(adjP = ir$BH_adjust_pvalue[match(irr$HPO_code, ir$phenotype_code)],
phenotype_name = ir$phenotype_name[match(irr$HPO_code, ir$phenotype_code)]) %>%
group_by(HPO_code,	phenotype) %>%
dplyr::select(-c(patients_with_hpo, total_patients_in_group))
fwrite(iat, "../result/Table3/Table3C.csv")
crr$biological_category <- crr$biological_measure %>%
gsub(., pattern = "^no", replacement = "") %>%
gsub(., pattern = "_.*$", replacement = "")
catr <- crr %>%
mutate(adjP = cr$BH_adjust_pvalue[match(crr$biological_category, cr$biological_measure)]) %>%
dplyr::select(-c(patient_count, total_patient_in_biological_measure))
fwrite(catr, "../result/Table3/Table35D.csv")
fwrite(catr, "../result/Table3/Table3D.csv")
# missing terms are designed by Luiza
# the first data frame describe the new terms (term and code) and their parents
mhtp <-
read_excel("../input/Missing_HPO_Terms_Proposal.LC.cleaned.xlsx",
sheet = "parents")
# vector of the terms
missing_HPO_terms <- unique(mhtp$ProposedTerm[is.na(mhtp$ProposedCode)])
# create temporary missing codes
nums <- seq(from = 9999901,
length.out = length(missing_HPO_terms))
missing_HPO_codes <- sprintf("HP:%07d", nums)
# assign them randomly
names(missing_HPO_codes) <- missing_HPO_terms
# input them in the df
for(i in 1:length(missing_HPO_codes)){
tt <- missing_HPO_codes[i]
mhtp$ProposedCode[mhtp$ProposedTerm == names(tt)] <- tt
}
# update parent code if relationship is known
u <- mhtp$ProposedParentTerm[mhtp$ProposedParentCode == "NA"]
for(i in 1:length(u)){
tc <- missing_HPO_codes[match(u[i], names(missing_HPO_codes))]
mhtp$ProposedParentCode[mhtp$ProposedParentTerm == names(tc)] <- tc
}
# each element is a character vector of HPO codes of the direct parents,
# and is named with the HPO code
missing_HPO_parents <- lapply(unname(missing_HPO_codes),
function(x) mhtp$ProposedParentCode[grep(x, mhtp$ProposedCode)])
names(missing_HPO_parents) <- missing_HPO_codes
# add the following:
# "Tuberculous mycobacterial infection"(#7) is parent to
# "Disseminated tuberculous mycobacterial infection" (#7)
# "Viral meningitis" is parent to "Herpes (simplex) meningitis"
# "Viral meningitis" is parent to  "Recurrent herpes meningitis"
# "Unusual bacterial infection" is parent to "Bacterial meningitis"
# "Non-infectious encephalitis" is parent to "Autoimmune encephalitis"
# vector of parents
pcv <- c("Tuberculous mycobacterial infection",
"Viral meningitis",
"Viral meningitis",
"Unusual bacterial infection",
"Non-infectious encephalitis")
# add the vector names, representing the children
# e.g. "Disseminated tuberculous mycobacterial infection" is child of
# "Tuberculous mycobacterial infection"
names(pcv) <- c("Disseminated tuberculous mycobacterial infection",
"Herpes (simplex) meningitis",
"Recurrent herpes meningitis",
"Bacterial meningitis",
"Autoimmune encephalitis")
# update relationships
for(i in 1:length(pcv)){
oc <- grep(pcv[i], names(missing_HPO_codes), fixed = TRUE) # the order of the parent
occ <- grep(names(pcv[i]), names(missing_HPO_codes), fixed = TRUE) # the order of the child
missing_HPO_parents[[occ]] <- c(missing_HPO_parents[[occ]], missing_HPO_parents[[oc]])
}
# each element is a character vector of HPO codes of the children,
# and is named with the HPO code
missing_HPO_children <- lapply(unname(missing_HPO_codes),
function(x) character())
names(missing_HPO_children) <- missing_HPO_codes
for(i in 1:length(pcv)){
# find the code for the parent (e.g. "HP:999990")
pc <- missing_HPO_codes[names(missing_HPO_codes) == pcv[i]]
# find the code for the child (e.g. "HP:9999908" )
cc <- missing_HPO_codes[names(missing_HPO_codes) == names(pcv)[i]]
# add the code of the child, when the element is the parent
missing_HPO_children[names(missing_HPO_children) == pc] <- cc
}
# list: each element is a character vector of HPO codes of all ancestors,
# including the direct parents, and is named with the HPO code
missing_HPO_ancestors <- lapply(missing_HPO_parents,
function(x) get_ancestors(hpo, x))
# update relationships
for(i in 1:length(pcv)){
oc <- grep(pcv[i], names(missing_HPO_codes), fixed = TRUE) # the order of the parent
occ <- grep(names(pcv[i]), names(missing_HPO_codes), fixed = TRUE) # the order of the child
missing_HPO_ancestors[[occ]] <- unique(c(missing_HPO_ancestors[[occ]],
unname(missing_HPO_codes[oc])))
}
# logical vector, each entry is false or true, and named with the HPO code
# none of the missing terms are obsolete
missing_HPO_obsolete <- rep(FALSE, length(missing_HPO_codes))
names(missing_HPO_obsolete) <- missing_HPO_codes
# Update the hpo with the new terms
hpo_with_missing_terms <- hpo
# named character: each entry is HPO code, and named with the HPO code
missing_HPO_codes1 <- missing_HPO_codes
names(missing_HPO_codes1) <- missing_HPO_codes1
hpo_with_missing_terms$id <- c(hpo_with_missing_terms$id,
missing_HPO_codes1)
# named character: each entry is HPO term, and named with the HPO code
missing_HPO_codes2 <- names(missing_HPO_codes)
names(missing_HPO_codes2) <- missing_HPO_codes
hpo_with_missing_terms$name <- c(hpo_with_missing_terms$name,
missing_HPO_codes2)
# list: each element is a character vector of HPO codes of the direct parents,
# and is named with the HPO code.
hpo_with_missing_terms$parents <- c(hpo_with_missing_terms$parents,
missing_HPO_parents)
# list: each element is a character vector of HPO codes of the children,
# and is named with the HPO code
hpo_with_missing_terms$children <- c(hpo_with_missing_terms$children,
missing_HPO_children)
# list: each element is a character vector of HPO codes of all ancestors,
# including the direct parents, and is named with the HPO code
hpo_with_missing_terms$ancestors <- c(hpo_with_missing_terms$ancestors,
missing_HPO_ancestors)
## add parent terms just in case
for(i in seq_along(missing_HPO_ancestors)) {
missing_HPO_ancestors[[i]] <- unique(c(missing_HPO_ancestors[[i]],
missing_HPO_parents[[i]]))
}
# list: each element is a FALSE/TRUE
# with names of HPO codes of obsolete terms
hpo_with_missing_terms$obsolete <- c(hpo_with_missing_terms$obsolete,
missing_HPO_obsolete)
# Update the hpo with the new terms
hpo2 <- hpo_with_missing_terms
# plot 1: plot all missing terms
jpeg("../result/SI/missing_terms_dag.jpeg",
quality = 900,
width = 2200,
height = 1400)
# # specify the exact set of terms to appear in the plot
# terms_to_plot <- unique(c(missing_HPO_codes,
#                           unlist(missing_HPO_parents),
#                           unlist(missing_HPO_children)))
# terms_to_plot <- unique(c(missing_HPO_codes,
#                           unlist(missing_HPO_parents)))
terms_to_plot <- remove_links(hpo2, unique(c(missing_HPO_codes,
get_ancestors(hpo2, missing_HPO_codes))))
# Character vector of colours
colours_for_terms <- ifelse(terms_to_plot %in% missing_HPO_codes,
"#af8dc3","powderblue")
onto_plot(
# ontology_index object
ontology = hpo2,
# specify the exact set of terms to appear in the plot
terms = terms_to_plot,
# Character vector of colours
fillcolor = colours_for_terms,
# Numeric vector of term frequencies named by term IDs
frequencies = get_term_frequencies(hpo2,
missing_HPO_codes),
# List of character vectors of ontological term IDs
term_sets = missing_HPO_codes,
fontsize = 30)
dev.off()
######################## source common libraries ###############################
source("common.R")
######################## import input ##########################################
patient_hpo_bio_mat <- readRDS("../result/patient_hpo_bio_mat.RDS")
############# Suppl Table Complete HPO list ####################################
df <- patient_hpo_bio_mat[grep(rownames(patient_hpo_bio_mat), pattern = "^HP"),]
HPO_code = row.names(df)
df1 <- data.table(HPO_code = HPO_code,
HPO_freq = rowSums(df),
HPO_name = hpo$name[match(HPO_code, names(hpo$name))])
fwrite(df1, "../result/SI/Suppl_Table_Complete_HPO_list.csv")
